!Plan
operations: 
  - !LoadFile
    #source: file:///home/arunesh.uma/uvc_nectar_init/
    #source: s3a://js-dpp-sit-data-customer-uvc-nectar-app/initial/1497283570676-1-EDW_DPP_CUST_Nectar_10_20170629_232128.dat
    source: s3a://js-dpp-sit-data-customer-uvc-nectar-app/initial/*.dat
    parser: !csv { header: false,delimiter: ',' ,schema: [enterprise_customer_id, lms_account_id,nectar_card_no, nectar_account_no, lms_status_code, active_date,inactive_date]}
    tableName: nectar_dat_initial_tmp
    

  - !print {sqlQuery: "select  * from nectar_dat_initial_tmp limit 10" }

  - !hive { table : raw.nectar_dat_initial1,  staging : true,
            sqlQuery : "SELECT null as file_id ,null as seq_num ,null as indvl_title ,null as indvl_gender ,null as indvl_first_initl ,null as indvl_middle_initl ,null as indvl_last_name ,null as indvl_first_name ,null as indvl_date_birth ,null as loc_po_box ,null as loc_sub_building_name ,null as loc_build_number ,null as loc_building_name ,null as loc_dependent_street_name ,null as loc_dependent_street_desc ,null as loc_street_name ,null as loc_street_description ,null as loc_double_dependent_locality ,null as loc_dependent_locality ,null as loc_county ,null as loc_town ,null as loc_postcode ,null as new_paf_key ,null as paf_po_box ,null as paf_sub_building_name ,null as paf_building_number ,null as paf_building_name ,null as paf_dependent_thrghfr_name ,null as paf_dependent_thrghfr_desc ,null as paf_thrghfr_name ,null as paf_thrghfr_description ,null as paf_double_dependent_locality ,null as paf_dependent_locality ,null as paf_county ,null as paf_town ,null as paf_postcode ,null as delivery_point_suffix ,enterprise_customer_id as ic_key ,null as ic_ind ,null as hh_key ,null as hh_ind ,null as vality_gas_flag ,null as mps_flag ,null as match_key_1 ,null as match_key_2 ,null as match_key_3 ,null as match_key_4 ,null as match_key_5 ,null as match_key_6 ,null as end_generic ,null as lms_create_update_ind ,null as lms_collector_type_code ,from_unixtime(unix_timestamp(active_date, 'yyyy-mm-dd'),'yyyymmdd')  as lms_customer_create_date ,null as lms_customer_create_time ,null as lms_customer_id ,nectar_account_no as lms_party_account_no ,null as lms_customer_type_code ,null as lms_acquisition_source_code ,null as lms_customer_title ,null as lms_first_name ,null as lms_first_name_date_stamp ,null as lms_first_name_time_stamp ,null as lms_middle_initial ,null as lms_surname ,null as lms_surname_date_stamp ,null as lms_surname_time_stamp ,null as lms_customer_suffix ,null as lms_gender ,null as lms_gender_date_stamp ,null as lms_gender_time_stamp ,null as lms_customer_language_code ,null as lms_tier_id ,null as lms_flat_name ,null as lms_building_number ,null as lms_building_name ,null as lms_street_address_1 ,null as lms_street_address_2 ,null as lms_street_address_3 ,null as lms_county ,null as lms_town ,null as lms_postcode ,null as lms_country_code ,null as lms_gas_flag ,null as lms_address_update_date ,null as lms_address_update_time ,null as lms_date_of_birth ,null as lms_month_of_birth ,null as lms_date_of_birth_date_stamp ,null as lms_date_of_birth_time_stamp ,null as lms_home_store_location ,null as lms_email_address ,null as lms_email_address_update_date ,null as lms_email_address_update_time ,null as lms_email_type ,null as lms_home_tel_no ,null as lms_home_tel_no_update_date ,null as lms_home_tel_no_update_time ,null as lms_work_tel_no ,null as lms_work_tel_no_update_date ,null as lms_work_tel_no_update_time ,null as lms_fax_no ,null as lms_mobile_tel_no ,null as lms_mobile_tel_no_update_date ,null as lms_mobile_tel_no_update_time ,null as lms_sefs_id ,null as lms_sefs_id_create_date ,null as lms_sefs_id_create_time ,lms_status_code as lms_status_code ,null as lms_status_reason_code ,null as lms_nectar_consent_ind ,null as lms_d_consent_ind ,null as lms_d_consent_ind_update_date ,null as lms_d_consent_ind_update_time ,null as lms_mresearch_ind ,null as lms_mresearch_create_date ,null as lms_mresearch_create_time ,null as lms_e_consent_ind ,null as lms_e_consent_ind_update_date ,null as lms_e_consent_ind_update_time ,null as lms_t_consent_ind ,null as lms_t_consent_ind_update_date ,null as lms_t_consent_ind_update_time ,null as lms_m_consent_ind ,null as lms_m_consent_ind_update_date ,null as lms_m_consent_ind_update_time ,null as lms_no_of_family_members ,null as lms_no_of_children ,null as lms_child1_gender ,null as lms_child1_date_of_birth ,null as lms_child2_gender ,null as lms_child2_date_of_birth ,null as lms_child3_gender ,null as lms_child3_date_of_birth ,null as lms_child4_gender ,null as lms_child4_date_of_birth ,null as lms_small_business_ind ,null as lms_dietary_preference_code_01 ,null as lms_dietary_preference_code_02 ,null as lms_dietary_preference_code_03 ,null as lms_demo_code_05 ,null as lms_demo_code_06 ,null as lms_demo_code_07 ,null as lms_demo_code_08 ,null as lms_demo_code_09 ,null as lms_demo_code_10 ,null as lms_demo_code_11 ,null as lms_demo_code_12 ,null as lms_demo_code_13 ,null as lms_demo_code_14 ,null as lms_demo_code_15 ,null as lms_company_turnover ,null as lms_no_of_organisation_members ,null as lms_business_contact_title ,null as lms_organisation_name ,null as lms_organisation_suffix ,null as lms_registration_number ,null as lms_organisation_sic_code ,null as lms_organisation_start_date ,null as end_lms ,null as sty_amendment_type ,null as sty_regno ,null as sty_userid ,null as sty_rcnum_filler ,nectar_card_no as sty_rcnum ,null as sty_title ,null as sty_fname ,null as sty_sname ,null as sty_dob ,null as sty_media_cd ,null as sty_media_code_type ,null as sty_email ,null as sty_home_tel ,null as sty_work_tel ,null as sty_consent ,null as sty_consent_date ,null as sty_taste_consent ,null as sty_taste_consent_date ,from_unixtime(unix_timestamp(inactive_date, 'yyyy-mm-dd'),'yyyymmdd') as sty_creation_date ,null as sty_cust_status ,null as sty_road_name ,null as sty_flat_number ,null as sty_house_name ,null as sty_house_number ,null as sty_town ,null as sty_county ,null as sty_postcode  
            FROM nectar_dat_initial_tmp" } 

    

  - !print {sqlQuery: "select   ic_key , lms_customer_create_date , lms_party_account_no , lms_status_code ,
 sty_rcnum , sty_creation_date  from raw.nectar_dat_initial1 limit 10" }

          
  - !sql {tableName: 'existing_source_id_tmp',sqlQuery: "select source_id as filename ,count(1) as row_count  from raw.nectar_dat_initial1 group by source_id"}


  - !hive {table : raw.customer_files_loaded,  staging : true,
            sqlQuery : "select  'nectar'  as filetype, filename,row_count from existing_source_id_tmp"
            }
  
  - !print {sqlQuery: "select  'LOADED SUCCESSFULLY' " }
